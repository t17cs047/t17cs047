
<form method="post" action="{% url 'write' %}" >{% csrf_token %}
	{{form.as_p}}
{% if messages %}
	<ul class="messages">
		{% for message in messages %}
			<li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
		{% endfor %}
	</ul>
{% endif %}
<div id="form_set">
		{{ formset.management_form }}
		{% for activity_form in formset %}
            <table class='no_error'>
            {{ activity_form.as_table }}
            <hr>
            </table>
       {% endfor %}
</div>
<hr>
<input type="button" value="Add More" id="add_more">
<div id="empty_form" style="display:none">
<hr>
<table class='no_error'>
	 {{ formset.empty_form.as_table }}
</table>
</div>  
	
	
	 <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/timedropper/1.0/timedropper.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/timedropper/1.0/timedropper.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>
        $('#add_more').click(function() {
             var form_idx = $('#id_activity_set-TOTAL_FORMS').val();		      
		      var option = $('#id_activity_set-0-project').children().clone();
		      var optionCount = $('#id_activity_set-0-project').children().length;
		      var str = "id_activity_set-" + form_idx + "-project";
		      $('#form_set').append($('#empty_form').html().replace(/__prefix__/g, form_idx));
             $('#id_activity_set-TOTAL_FORMS').val(parseInt(form_idx) + 1);
             $('[id $= "time" ]').timeDropper({
              format: "H:mm",
              setCurrentTime: false,
          });
				var i = 0;
				$('#' + str).children().remove();
				$('#' + str).append(option);
	
	
           });
      </script>
			<input type="submit"/>
          </form>
          <a href="{% url 'index' %}">index</a>
                  
 <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/timedropper/1.0/timedropper.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/timedropper/1.0/timedropper.min.js"></script>
    <script>
      $(function () {
          $('[id $= "time" ]').timeDropper({
              format: "H:mm",
              setCurrentTime: false,
          });
      });
  </script>
  <script>
  $('form').submit(function(){
  		var num = $('#id_activity_set-TOTAL_FORMS').val();
  		var start_array = [];
  		var end_array = [];
  		for( var i = 0; i < num ; i++){
  			var str1 = "id_activity_set-" + i + "-start_time";
  			var str2 = "id_activity_set-" + i + "-end_time";
  			start_array.push($('#' + str1).val());
  			end_array.push($('#' + str2).val());
  			if(start_array[i] >= end_array[i]){
  				alert("the start_time is ahead of the end_time");
  				return false;
  			}
  		}
  		console.log(num);
		for(var i = 0; i < num - 1; i++ ){
			for( var  j = i + 1; j < num; j++){
				if(start_array[i] <= end_array[j] && end_array[i] >= start_array[j]){
					alert("overlap of the time");
					return false;
				}else{
					//do nothing
				}
			}
		}
		return true;
  		});
  </script>
  
             
   